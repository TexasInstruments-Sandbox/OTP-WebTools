<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TI Tools - Key Configuration Tool</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="top-nav">
        <div class="nav-container">
            <a href="index.html" class="nav-brand-section">
                <div class="nav-brand">TI Tools</div>
                <div class="nav-tagline">Web-based utilities for TI MPU processors</div>
            </a>
            <div class="nav-links">
                <a href="https://github.com/TexasInstruments"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="nav-link">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                    GitHub
                </a>
                <a href="https://www.ti.com/design-development/software-design/open-source.html"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="nav-link">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0zM2.04 4.326c.325 1.329 2.532 2.54 3.717 3.19.48.263.793.434.743.484-.08.08-.162.158-.242.234-.416.396-.787.749-.758 1.266.035.634.618.824 1.214 1.017.577.188 1.168.38 1.286.983.082.417-.075.988-.22 1.52-.215.782-.406 1.48.22 1.48 1.5-.5 3.798-3.186 4-5 .138-1.243-2-2-3.5-2.5-.478-.16-.755.081-.99.284-.172.15-.322.279-.51.216-.445-.148-2.5-2-1.5-2.5.78-.39.952-.171 1.227.182.078.099.163.208.273.318.609.304.662-.132.723-.633.039-.322.081-.671.277-.867.434-.434 1.265-.791 2.028-1.12.712-.306 1.365-.587 1.579-.88A7 7 0 1 0 2.04 4.327z"/>
                    </svg>
                    Open Source @ TI
                </a>
                <a href="https://www.ti.com/product-category/microcontrollers-processors/overview.html"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="nav-link">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                    </svg>
                    Learn More
                </a>
            </div>
        </div>
    </nav>

    <div class="container">
        <header>
            <h1>TI Tools</h1>
            <p class="subtitle">Key Configuration Tool for Keywriter-Lite</p>
            <div class="header-links">
                <a href="index.html" class="doc-link">
                    ‚Üê Back to Tools
                </a>
                <a href="https://downloads.ti.com/tisci/esd/latest/6_topic_user_guides/key_writer_lite.html"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="doc-link">
                    View Keywriter-Lite Documentation
                </a>
            </div>
        </header>

        <main>
            <section class="info-section">
                <div class="experimental-warning">
                    <h3>üß™ Experimental Web Tool</h3>
                    <p><strong>This is an experimental web-based implementation of the TI Key Configuration Tool.</strong></p>
                    <p>For production use, please use the official Python tool from Texas Instruments:</p>
                    <p><a href="https://github.com/TexasInstruments/security-utils/tree/release" target="_blank" rel="noopener noreferrer">
                        https://github.com/TexasInstruments/security-utils/tree/release
                    </a></p>
                    <p>This web tool is useful for learning, planning configurations, and generating JSON files that can be loaded into the official Python tool.</p>
                </div>

                <div class="disclaimer-box">
                    <h3>‚ö†Ô∏è Disclaimer</h3>
                    <p>This Key configuration tool is provided solely for reference purposes.</p>
                    <p>The output generated by this tool should be thoroughly validated in a test environment before being applied to production devices.</p>
                    <p>Texas Instruments makes no warranty regarding the accuracy, completeness, or suitability of the generated configurations for any particular purpose. The user assumes full responsibility for the verification and validation of all generated key material and configurations.</p>
                    <p><strong>Improper use of this tool may result in permanent device configuration that cannot be reversed due to the one-time programmable (OTP) nature of the target memory.</strong></p>
                    <p>This tool is not a substitute for comprehensive security planning and risk assessment. Users should consult the complete product documentation and security best practices when implementing security features in production environments.</p>
                </div>
            </section>

            <section class="input-section">
                <h2>Configuration Options</h2>

                <div class="config-group">
                    <label for="deviceSelect">Device:</label>
                    <select id="deviceSelect">
                        <option value="am62lx">AM62Lx</option>
                    </select>
                </div>

                <div class="config-group">
                    <label for="cmdIdSelect">Command ID:</label>
                    <select id="cmdIdSelect">
                        <option value="one-shot">One-Shot (0)</option>
                        <option value="multi-shot">Multi-Shot (1)</option>
                        <option value="smpkh">SMPKH (2)</option>
                        <option value="bmpkh">BMPKH (3)</option>
                        <option value="key-cnt">Key Count (4)</option>
                        <option value="key-rev">Key Revision (5)</option>
                        <option value="sbl-swrev">SBL Software Revision (6)</option>
                        <option value="sysfw-swrev">SYSFW Software Revision (7)</option>
                        <option value="brdcfg-swrev">BoardConfig Software Revision (8)</option>
                        <option value="msv">Model Specific Value (9)</option>
                        <option value="jtag-disable">JTAG Disable (10)</option>
                        <option value="boot-mode">Boot Mode (11)</option>
                        <option value="ext-otp">Extended OTP (12)</option>
                    </select>
                </div>

                <!-- MPK Options -->
                <div class="config-group" id="mpkOptsGroup">
                    <h3>MPK Options</h3>
                    <label for="mpkOpts">MPK Options (10-bit hex, reserved for future use - use 0x000):</label>
                    <input type="text" id="mpkOpts" placeholder="0x000" value="0x000" maxlength="5">
                </div>

                <!-- SMPKH -->
                <div class="config-group" id="smpkhGroup" style="display: none;">
                    <h3>SMPKH (Secure MPK Hash)</h3>
                    <label for="smpkhValue">SMPKH Value (512-bit hex - 128 hex characters):</label>
                    <textarea id="smpkhValue" rows="4" placeholder="Enter 128 hex characters or load from public key file"></textarea>
                    <button id="loadSmpkhBtn" class="secondary">Load from Public Key File</button>
                    <input type="file" id="smpkhFileInput" accept=".der" style="display: none;">
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="smpkhEnable" checked> Enable</label>
                        <label><input type="checkbox" id="smpkhWrite"> Write</label>
                        <label><input type="checkbox" id="smpkhWriteProt"> Write Protect</label>
                        <label><input type="checkbox" id="smpkhOverride"> Override</label>
                    </div>
                </div>

                <!-- BMPKH -->
                <div class="config-group" id="bmpkhGroup" style="display: none;">
                    <h3>BMPKH (Backup MPK Hash)</h3>
                    <label for="bmpkhValue">BMPKH Value (512-bit hex - 128 hex characters):</label>
                    <textarea id="bmpkhValue" rows="4" placeholder="Enter 128 hex characters or load from public key file"></textarea>
                    <button id="loadBmpkhBtn" class="secondary">Load from Public Key File</button>
                    <input type="file" id="bmpkhFileInput" accept=".der" style="display: none;">
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="bmpkhEnable" checked> Enable</label>
                        <label><input type="checkbox" id="bmpkhWrite"> Write</label>
                        <label><input type="checkbox" id="bmpkhWriteProt"> Write Protect</label>
                        <label><input type="checkbox" id="bmpkhOverride"> Override</label>
                    </div>
                </div>

                <!-- Key Count -->
                <div class="config-group" id="keyCntGroup" style="display: none;">
                    <h3>Key Count</h3>
                    <label for="keyCntValue">Key Count (0-255):</label>
                    <input type="number" id="keyCntValue" min="0" max="255" value="0">
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="keyCntEnable" checked> Enable</label>
                        <label><input type="checkbox" id="keyCntWrite"> Write</label>
                        <label><input type="checkbox" id="keyCntWriteProt"> Write Protect</label>
                        <label><input type="checkbox" id="keyCntOverride"> Override</label>
                    </div>
                </div>

                <!-- Key Revision -->
                <div class="config-group" id="keyRevGroup" style="display: none;">
                    <h3>Key Revision</h3>
                    <label for="keyRevValue">Key Revision (0-255):</label>
                    <input type="number" id="keyRevValue" min="0" max="255" value="0">
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="keyRevEnable" checked> Enable</label>
                        <label><input type="checkbox" id="keyRevWrite"> Write</label>
                        <label><input type="checkbox" id="keyRevWriteProt"> Write Protect</label>
                        <label><input type="checkbox" id="keyRevOverride"> Override</label>
                    </div>
                </div>

                <!-- SBL Software Revision -->
                <div class="config-group" id="sblSwrevGroup" style="display: none;">
                    <h3>SBL Software Revision</h3>
                    <label for="sblSwrevValue">SBL Software Revision (0-255):</label>
                    <input type="number" id="sblSwrevValue" min="0" max="255" value="0">
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="sblSwrevEnable" checked> Enable</label>
                        <label><input type="checkbox" id="sblSwrevWrite"> Write</label>
                        <label><input type="checkbox" id="sblSwrevWriteProt"> Write Protect</label>
                        <label><input type="checkbox" id="sblSwrevOverride"> Override</label>
                    </div>
                </div>

                <!-- SYSFW Software Revision -->
                <div class="config-group" id="sysfwSwrevGroup" style="display: none;">
                    <h3>SYSFW Software Revision</h3>
                    <label for="sysfwSwrevValue">SYSFW Software Revision (0-255):</label>
                    <input type="number" id="sysfwSwrevValue" min="0" max="255" value="0">
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="sysfwSwrevEnable" checked> Enable</label>
                        <label><input type="checkbox" id="sysfwSwrevWrite"> Write</label>
                        <label><input type="checkbox" id="sysfwSwrevWriteProt"> Write Protect</label>
                        <label><input type="checkbox" id="sysfwSwrevOverride"> Override</label>
                    </div>
                </div>

                <!-- BoardConfig Software Revision -->
                <div class="config-group" id="brdcfgSwrevGroup" style="display: none;">
                    <h3>BoardConfig Software Revision</h3>
                    <label for="brdcfgSwrevValue">BoardConfig Software Revision (0-255):</label>
                    <input type="number" id="brdcfgSwrevValue" min="0" max="255" value="0">
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="brdcfgSwrevEnable" checked> Enable</label>
                        <label><input type="checkbox" id="brdcfgSwrevWrite"> Write</label>
                        <label><input type="checkbox" id="brdcfgSwrevWriteProt"> Write Protect</label>
                        <label><input type="checkbox" id="brdcfgSwrevOverride"> Override</label>
                    </div>
                </div>

                <!-- Model Specific Value -->
                <div class="config-group" id="msvGroup" style="display: none;">
                    <h3>Model Specific Value (MSV)</h3>
                    <label for="msvValue">MSV (20-bit hex - 5 hex characters):</label>
                    <input type="text" id="msvValue" placeholder="0x00000" maxlength="7">
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="msvEnable" checked> Enable</label>
                        <label><input type="checkbox" id="msvWrite"> Write</label>
                        <label><input type="checkbox" id="msvWriteProt"> Write Protect</label>
                        <label><input type="checkbox" id="msvOverride"> Override</label>
                    </div>
                </div>

                <!-- JTAG Disable -->
                <div class="config-group" id="jtagDisableGroup" style="display: none;">
                    <h3>JTAG Disable</h3>
                    <p>Value is automatically set based on enable flag state.</p>
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="jtagDisableEnable" checked> Enable</label>
                        <label><input type="checkbox" id="jtagDisableWrite"> Write</label>
                        <label><input type="checkbox" id="jtagDisableWriteProt"> Write Protect</label>
                        <label><input type="checkbox" id="jtagDisableOverride"> Override</label>
                    </div>
                </div>

                <!-- Boot Mode -->
                <div class="config-group" id="bootModeGroup" style="display: none;">
                    <h3>Boot Mode</h3>
                    <label for="bootModeFuseIdx">Fuse Index (0-31):</label>
                    <input type="number" id="bootModeFuseIdx" min="0" max="31" value="0">
                    <label for="bootModeValue">Boot Mode Value (25-bit hex - up to 7 hex characters):</label>
                    <input type="text" id="bootModeValue" placeholder="0x0000000" maxlength="9">
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="bootModeEnable" checked> Enable</label>
                        <label><input type="checkbox" id="bootModeWrite"> Write</label>
                        <label><input type="checkbox" id="bootModeWriteProt"> Write Protect</label>
                        <label><input type="checkbox" id="bootModeOverride"> Override</label>
                    </div>
                </div>

                <!-- Extended OTP -->
                <div class="config-group" id="extOtpGroup" style="display: none;">
                    <h3>Extended OTP</h3>
                    <label for="extOtpOffset">Offset (in bits):</label>
                    <input type="number" id="extOtpOffset" min="0" value="0">
                    <label for="extOtpSize">Size (number of bits):</label>
                    <input type="number" id="extOtpSize" min="0" value="0">
                    <label for="extOtpData">Data (hex):</label>
                    <textarea id="extOtpData" rows="4" placeholder="Enter hex data"></textarea>
                    <label for="extOtpWpFlags">Write Protect Flags (64-bit hex):</label>
                    <input type="text" id="extOtpWpFlags" placeholder="0x0000000000000000" maxlength="18">
                    <label for="extOtpRpFlags">Read Protect Flags (64-bit hex):</label>
                    <input type="text" id="extOtpRpFlags" placeholder="0x0000000000000000" maxlength="18">
                    <div class="checkbox-group">
                        <label><input type="checkbox" id="extOtpEnable" checked> Enable</label>
                        <label><input type="checkbox" id="extOtpWrite"> Write</label>
                        <label><input type="checkbox" id="extOtpOverride"> Override</label>
                    </div>
                </div>

                <div class="button-group">
                    <button id="generateBtn">Generate Blob</button>
                    <button id="generateCBtn" class="secondary">Generate C File</button>
                    <button id="saveConfigBtn" class="secondary">Save Configuration</button>
                    <button id="loadConfigBtn" class="secondary">Load Configuration</button>
                    <input type="file" id="configFileInput" accept=".json" style="display: none;">
                </div>
            </section>

            <section class="results-section" id="resultsSection" style="display: none;">
                <h2>Generated Output</h2>
                <div id="resultsContainer"></div>
            </section>

            <section class="info-section">
                <h2>About This Tool</h2>
                <p>
                    This tool generates blobs for programming keys using the keywriter-lite feature.
                    The keywriter-lite feature is currently available only on AM62Lx devices.
                </p>
                <p>
                    Generated binary files can be used as input to the U-Boot prompt as described in the
                    <a href="https://software-dl.ti.com/processor-sdk-linux/esd/AM62LX/latest/exports/docs/linux/Foundational_Components/U-Boot/UG-Key-Writer-Lite.html"
                       target="_blank"
                       rel="noopener noreferrer">
                        U-Boot Keywriter-Lite User Guide
                    </a>.
                </p>
                <h3>Features</h3>
                <ul>
                    <li>Generate keywriter-lite blob for all command modes</li>
                    <li>Generate a C file with the configured keys for review</li>
                    <li>Save and restore progress via JSON configuration files</li>
                    <li>Real-time data validation</li>
                    <li>Support for MPK hashes, key counts, software revisions, and more</li>
                </ul>
            </section>
        </main>

        <footer>
            <p>TI Tools | Key Configuration Tool for Keywriter-Lite</p>
        </footer>
    </div>

    <script src="security-utils.js"></script>
</body>
</html>
